# Solid color LEFT (accepts 0..255 or 0..1)
[gcode_macro LED_L]
description: "LED_L [R=][G=][B=]  (left zone)"
gcode:
  {% set led  = printer["gcode_macro LED_ZONES"].led|string %}
  {% set lf   = printer["gcode_macro LED_ZONES"].left_from|int %}
  {% set lt   = printer["gcode_macro LED_ZONES"].left_to|int %}
  {% set br   = printer["gcode_macro LED_STATE_L"].brightness|float %}
  {% set r_in = params.R|default(255)|float %}
  {% set g_in = params.G|default(255)|float %}
  {% set b_in = params.B|default(255)|float %}
  {% set div  = 255.0 if (r_in>1.0 or g_in>1.0 or b_in>1.0) else 1.0 %}
  {% set r = (r_in/div) * br %}
  {% set g = (g_in/div) * br %}
  {% set b = (b_in/div) * br %}

  SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=r VALUE={r}
  SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=g VALUE={g}
  SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=b VALUE={b}
  SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=mode VALUE="'solid'"

  {% for i in range(lf, lt+1) %}
    SET_LED LED={led} INDEX={i} RED={r} GREEN={g} BLUE={b} TRANSMIT={(1 if i==lt else 0)}
  {% endfor %}

[gcode_macro LED_OFF_L]
gcode:
  {% set led  = printer["gcode_macro LED_ZONES"].led|string %}
  {% set lf   = printer["gcode_macro LED_ZONES"].left_from|int %}
  {% set lt   = printer["gcode_macro LED_ZONES"].left_to|int %}
  SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=mode VALUE="'off'"
  {% for i in range(lf, lt+1) %}
    SET_LED LED={led} INDEX={i} RED=0 GREEN=0 BLUE=0 TRANSMIT={(1 if i==lt else 0)}
  {% endfor %}

[gcode_macro LED_BRIGHT_L]
description: "LED_BRIGHT_L B=0..1"
gcode:
  {% set b = params.B|default(0.30)|float %}
  {% if b < 0.0 %}{% set b = 0.0 %}{% endif %}
  {% if b > 1.0 %}{% set b = 1.0 %}{% endif %}
  SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=brightness VALUE={b}
  {action_respond_info("Left brightness set to " ~ ("%0.2f"|format(b)))}
  {% if printer["gcode_macro LED_STATE_L"].mode == "solid" %}
    LED_L R={(printer["gcode_macro LED_STATE_L"].r/ (printer["gcode_macro LED_STATE_L"].brightness if printer["gcode_macro LED_STATE_L"].brightness>0 else 1.0))*255}
         G={(printer["gcode_macro LED_STATE_L"].g/ (printer["gcode_macro LED_STATE_L"].brightness if printer["gcode_macro LED_STATE_L"].brightness>0 else 1.0))*255}
         B={(printer["gcode_macro LED_STATE_L"].b/ (printer["gcode_macro LED_STATE_L"].brightness if printer["gcode_macro LED_STATE_L"].brightness>0 else 1.0))*255}
  {% endif %}

[gcode_macro LED_EFFECT_L]
description: "LED_EFFECT_L MODE=off|pulse|chase|progress"
gcode:
  {% set mode = params.MODE|default("off")|lower %}
  {% if mode == "off" %}
    SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=mode VALUE="'off'"
    UPDATE_DELAYED_GCODE ID=LED_TICK_L DURATION=0
  {% elif mode == "pulse" %}
    SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=mode VALUE="'pulse'"
    UPDATE_DELAYED_GCODE ID=LED_TICK_L DURATION=0.05
  {% elif mode == "chase" %}
    SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=mode VALUE="'chase'"
    UPDATE_DELAYED_GCODE ID=LED_TICK_L DURATION=0.05
  {% elif mode == "progress" %}
    SET_GCODE_VARIABLE MACRO=LED_STATE_L VARIABLE=mode VALUE="'progress'"
    UPDATE_DELAYED_GCODE ID=LED_TICK_L DURATION=0.25
  {% else %}
    {action_respond_info("Unknown left mode: " ~ mode)}
  {% endif %}
